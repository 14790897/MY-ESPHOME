# AP 模式与离线配网指南

本文介绍设备在无可用网络时，如何通过 AP（热点）模式进入本地门户页面完成 Wi‑Fi 重新配置。本仓库的接收端已启用 AP 回退与 Captive Portal 功能，默认热点信息如下：

- AP SSID：`My-ESPHome-AP`
- AP 密码：`12345678`


---

## 适用场景

- 首次上电，设备尚未配置正确的 Wi‑Fi 凭据。
- 路由器更换/改密，设备无法连接既有 Wi‑Fi。
- 需要在离线（无互联网/无路由）环境下临时访问设备页面或切换网络。

---

## 工作原理

在 `wifi` 连接失败时，ESPHome 会自动开启回退 AP 热点（配置于 `wifi.ap`），并启用 `captive_portal`。手机/电脑连接该热点后会弹出本地门户页面（或手动访问 192.168.4.1），可进行设备访问与配网操作。(无网环境下需等待一分钟才会开启AP)

关键配置见接收端：`configs/displays/envpanel-espnow-c3.yaml:32`

```yaml
wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  ap:
    ssid: "My-ESPHome-AP"
    password: "12345678"
captive_portal:
```

---

## 快速操作步骤

1. 上电设备，等待约 20–60 秒，设备会切换至 AP 模式并广播热点 `My-ESPHome-AP`。
2. 使用手机/电脑连接该热点，输入密码 `12345678`。
3. 一般会自动弹出门户页面；若未弹出，手动在浏览器访问 `http://192.168.4.1/`。
4. 在门户或页面中完成 Wi‑Fi 重新配置（输入新的 SSID/密码）。
5. 设备将自动尝试连接新网络，连接成功后热点会关闭，恢复正常工作。

注意：首次连接热点后若页面加载异常，或者无法访问, 可关闭蜂窝数据（移动网络）或勾选“使用此网络时保持连接”，再重新访问 192.168.4.1。

---